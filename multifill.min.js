(function(e){function n(n,r){this.config=e.extend({},t,r);this.elem=n;this.listdiv=false;this.listitem=false;if(this.config["data"]!==false){this.init()}}var t={data:false,max_suggestion:3};n.prototype.init=function(){function s(t){var r=e("#"+t).attr("data-mf-position");var i=n[r]["fields"];if(i!==undefined){for(var s=0;s<i.length;s++){if(e(i[s]["selector"]).length!==0){var o=e(i[s]["selector"]).attr("type");if(o==undefined){var u=e(i[s]["selector"])[0].nodeName.toLowerCase();if(u.toLowerCase()=="select"){e(i[s]["selector"]+" option[value='"+i[s]["value"]+"']").prop("selected",true)}else{console.log("Cannot assigned value in element with selector"+i[s]["selector"])}}else{if(o.toLowerCase()=="radio"){e(i[s]["selector"]).each(function(){e(this).prop("checked",false);if(e(this).val()==i[s]["value"]){e(this).prop("checked",true)}})}else if(o.toLowerCase()=="checkbox"){var a=[];if(typeof i[s]["value"]=="object"){a=i[s]["value"]}else{a.push(i[s]["value"])}e(i[s]["selector"]).each(function(){e(this).prop("checked",false);for(var t=0;t<a.length;t++){if(a[t]==e(this).val()){e(this).prop("checked",true)}}})}else{e(i[s]["selector"]).val(i[s]["value"])}}}else{console.log("Multifill warning : No element has an id of "+i[s]["id"])}}}}function o(){var r=n[0]["fields"];for(var i=0;i<r.length;i++){if(r!==undefined&&e(r[i]["selector"]).attr("id")!==t.elemid){if(e(r[i]["selector"]).length!==0){var s=e(r[i]["selector"]).attr("type");if(s==undefined){var o=e(r[i]["selector"])[0].nodeName.toLowerCase();if(o.toLowerCase()=="select"){e(r[i]["selector"]).attr("selected",false)}else{console.log("Cannot clear value in element with selector"+r[i]["selector"])}}else{if(s.toLowerCase()=="radio"){e(r[i]["selector"]).each(function(){e(this).prop("checked",false)})}else if(s.toLowerCase()=="checkbox"){e(r[i]["selector"]).each(function(){e(this).prop("checked",false)})}else{e(r[i]["selector"]).val("")}}}else{console.log("Multifill warning : No element has an id of "+r[i]["id"])}}}}var t=this;var n=t.config.data;var r=0;var i=1;this.elemid=e(t.elem).attr("id");this.listdiv="multifill-"+t.elemid+"-suggestion";this.listitem="multifill-"+t.elemid+"-suggestion-item";e("<div>",{id:t.listdiv}).insertAfter(t.elem);e("#"+this.listdiv).css({position:"absolute","z-index":9999,"min-width":e(this.elem).width()+"px",border:"1px solid #BEBCBC","background-color":"white",display:"none","max-height":"150px","overflow-y":"auto"});e(window).resize(function(){e("#"+t.listdiv).css({"min-width":e(this.elem).width()+"px"})});e("body").delegate("."+t.listitem,"mouseover",function(){var n=this.id;var s=n.split("_")[1];r=parseInt(s);i=3;e("."+t.listitem).removeClass("multifill_selected_item");e(this).addClass("multifill_selected_item")});e("body").undelegate("click").delegate("."+t.listitem,"touchstart",function(){var n=this.id;s(n);e("#"+t.listdiv).html("");e("#"+t.listdiv).hide();return false});e("body").undelegate("click").delegate("."+t.listitem,"click",function(){var n=this.id;s(n);e("#"+t.listdiv).html("");e("#"+t.listdiv).hide();return false});e(this.elem).keyup(function(u){var a=0;if(u.keyCode!==40&&u.keyCode!==38){if(u.keyCode!==13){o()}e("#"+t.listdiv).scrollTop(0);e("#"+t.listdiv).html("");e("#"+t.listdiv).hide();var f=e(this).val();r=0;i=1;if(f==""){e("#"+t.listdiv).html("");return true}e("#"+t.listdiv).css({"min-width":e(this.elem).width()+"px"});var l=[];for(var c=0;c<n.length;c++){if(n[c]["displayname"].toLowerCase().indexOf(f.toLowerCase())!==-1){var h={displayname:n[c]["displayname"],position:c};l.push(h);var p=l.sort(function(e,t){var n=e.displayname;var r=t.displayname;return n<r?-1:n>r?1:0})}}for(var d=0;d<l.length;d++){if(d<t.config["max_suggestion"]){e("<div>",{"class":"multifill-"+t.elemid+"-suggestion-item",id:"multifill-"+t.elemid+"-suggestion-item_"+a,"data-mf-position":l[d]["position"],text:l[d]["displayname"],style:"padding:5px 10px 5px 10px;"}).appendTo(e("#"+t.listdiv)[0]);a++}}if(a>0){e("#"+t.listdiv).show();e("#"+t.listdiv).css({width:""}).css({width:parseInt(e("#"+t.listdiv).width())+30+"px"})}}var v=Math.floor(parseFloat(e("#"+t.listdiv).height())/parseFloat(e("."+t.listitem).height()+10));var m=Math.floor(parseFloat(e("#"+t.listdiv).height())/parseFloat(e("."+t.listitem).height()+10));if(u.keyCode==38){if(r>=v){e("#"+t.listdiv).scrollTop(e("#"+t.listdiv).scrollTop()-30)}if(r!==0){if(i==1&&i!==3)r--;if(e("#"+"multifill-"+t.elemid+"-suggestion-item_"+r)[0]!==undefined){i=0;r--;e("."+t.listitem).removeClass("multifill_selected_item");e("#"+"multifill-"+t.elemid+"-suggestion-item_"+r).addClass("multifill_selected_item");s("multifill-"+t.elemid+"-suggestion-item_"+r)}}}if(u.keyCode==40){if(i==0||i==3)r++;var g="multifill-"+t.elemid+"-suggestion-item_"+r;if(e("#"+g)[0]!==undefined){if(r>=v){e("#"+t.listdiv).scrollTop(e("#"+t.listdiv).scrollTop()+30)}e("."+t.listitem).removeClass("multifill_selected_item");e("#"+g).addClass("multifill_selected_item");s(g);r++;i=1}}if(u.keyCode==13){e("#"+t.listdiv).html("");e("#"+t.listdiv).hide();return false}});e("body").click(function(){e("#"+t.listdiv).html("");e("#"+t.listdiv).hide()})};e.fn.Multifill=function(e){new n(this.first(),e);return this.first()}})(jQuery)